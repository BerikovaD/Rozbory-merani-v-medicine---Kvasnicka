---
title: "Vizualizácia v R: 1. èas»"
output: html_notebook
---

U¾ sme kreslili grafy príkazmi *plot* a *lines*. To je ¹tandardná funkcionalita R, ale nie je úplne pohodlná na pou¾ívanie. 

V tejto èasti sa zoznámime z prvým z balíkov zo skupiny *tidyverse*: je to kresliaci balík __ggplot2__. 

__ggplot2__ je výnimoèný svojou funkcionalitou, kvalitou výstupu a osobitou filozofiou. Ako so v¹etkým v R, budete si chvíµu vznika», ale sµubujem, ¾e to èo získate na prvý pokus bude v¾dy o niekoµko tried lep¹ie ako prvý pokus o graf v Exceli.

```{r}
library(tidyverse)
```

Neznepokojujeme sa výstrahami. *Tidyverse* predefinuje niektoré veci v R, ale to nás nemusí znepokojova». 

### Dátový súbor __mpg__

Dátový súbor __mpg__ je súèas»ou balíka *ggplot2*, teda plným menom __ggplot2::mpg__, keby sme sa obávali konfliktu názvov. Dátový súbor obsahuje merania spotreby automobilov, vykonané americkou *Environment Protection Agency* (EPA) na 234 typoch automobilov v rokoch 1999-2008. 

```{r}
help(mpg)
head(mpg)
```

### Prvý graf: dojazd na jeden galón (hwy) v závislosti od objemu motora

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```
Vidím negatívnu závislos» medzi objemom motora a dojazdom. Teda autá s väè¹ím motorom prejd na 1 galón men¹iu vzdialenos» ako men¹ie autá. 

__ggplot()__ vytvorí súradnicový systém a prázdny graf. 

__geom_xxx()__ pridávajú do grafu jednu alebo niekoµko vrstiev objektov. __Geom_point__ pridá vrstvu s bodmi grafu. 

Ka¾dá funkcia __geom_xxx__ vy¾aduje ako argument priradenie (mapping) vlastností (ståpcov) dát k vizuálnym (estetickým) prvkom grafu (odtiaµ __aes()__), ako sú polohy bodov,farba, veµkos» a tvar symbolov, farba výplní, èiar a podobne. V na¹om prípade sme priradili __displ__ x-ovej a __hwy__ y-ovej súradnici bodov na grafe.

V¹eobecný predpis je 

__ggplot(data = \<DATA\>) + \<GEOM_FUNKCIA\>(mapping = aes(\<PRIRADENIA\))__

__Úlohy__

1. Spustite __ggplot(mpg)__ bez __geom_xxxx()__. Èo vidíte?

2. Koµko ståpcov a riadkov má súbor __mtcars__?

3. Aký význam má ståpec __mpg$drv__?

4. Nakreslite graf __hwy__ v závislosti od __cyl__.

5. Nakreslite graf __class__ v závislosti od __drv__. Je to u¾itoèný graf?

Poïme vyskú¹a» nejaké zaujímavej¹ie priradenia.

### Zlo¾itej¹ie priradenia

V na¹om grafe mám zobrazené dve vlastnosti áut zo súboru __mpg__: objem motora a vzdialenos», ktorú auto prejde na 1 galón paliva. Prvky grafu - v na¹om prípade body - majú e¹te ïal¹ie vlastnosti, napríklad veµkos», tvar, farbu, ktorým mô¾eme priradi» ïal¹ie ståpce súboru __mpg__ a tak súèasne zobrazi» vv grafe viac ako 2 parametre. 

Predstavme si, ¾e nás zaujíma, èi sa niektoré triedy áut nevyskytujú v na¹om grafe v anomálnych polohách. Vezmime ståpec __class__ a priraïme jej úrovne (preto¾e to je kvalitatívna premenná) farbe bodov v grafe.

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, colour = class))
```

Vidíme, ¾e ggplot vybral farby pre triedy áut a vytvoril ku grafu aj legendu. 

Tie¾ vidíme, ¾e 5 zo ¹iestich áut nad hlavnou krivkou vpravo dole sú ¹portové autá - majú veµký motor, ale sú oveµa µah¹ie ako SÚV s podobne veµkým motorom. Preto¾e to sú *premotorované* autá, vymykajú sa z typickej závislosti.

__Úlohy__ 

1. Skúste priradi» __class__ veµkosti symbolov v grafe (size = class). Funguje? Je to dobrý nápad?

2. Ïal¹ie estetiky, ktorým mô¾ete priradi» __class__ sú sýtos» (__alpha__) zafarbenia bodov a tvar (__shape__) bodov. Vysk¹ajte a posúïte.

Vlastnosti grafu mô¾eme nastavi» aj manuálne. Napríklad mô¾eme predpísa» veµkos» bodov:

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, colour = class), size = 3)
```
Takto predpísané vlastnosti neurèujú vlastnosti mapovania, iba celkový výzor grafu. Farby predpisujeme ako znakový re»azec ("red"), veµkos» bodov v milimetroch a tvar bodov ako kód tvaru z tabuµky tvarov (napríklad *http://www.sthda.com/english/wiki/ggplot2-point-shapes*).

__Úlohy__

1. Ktoré zo ståpcov __mpg__ sú spojité, a ktoré kategoriálne? Ako to spoµahlivo zistíme?

2. Ako sa správa priradenie premennej veµkosti, farbe a tvaru (colour, size, shape) pre spojité a kategoriálne premenné? Preskúmajte.

3. Èo sa stane, ak priradíte estetiku nieèomu inému ako dátovému ståpcu, napríklad __color = displ < 5__?

### Èo keï to nefunguje?

Neprepadajte panike. 

* Nemáte v kóde nejaké divné znaèky od syntax highlightera? 

* Máte chybovú hlá¹ku? Hurá, skúste pochopi», èo hovorí, alebo ju celú skopírujte do prehliadaèa a Google raï.

* Niè sa nestalo? Pozrite sa, èi ste zle nerozdelili viacriadkový príkaz. R musí chápa», ¾e riadok pokraèuje, tak¾e ak je medzi dvoma èas»ami napríklad __+__, musí by» na konci riadku pred zalomením, a nie na zaèiatku ïal¹ieho riadku. 

* Skúste help k funkcii, ktorú pou¾ívate (__help(geom_point)__ alebo __?geom_point__)

### Panely - __Facets__

E¹te jeden spôsob, ako prida» do grafu ïal¹ie premenné, je rozdeli» graf do viacerých panelov a v ka¾dom zobrazi» iba podmno¾inu dát. Tento spôsob je vhodný pre kategoriálne dáta.

Ak takto chceme rozdeli» ná¹ graf podµa (jednej, diskrétnej) premennej, pou¾ijeme funkciu __facet_wrap__:

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, colour = class)) +
  facet_wrap(~ class, nrow = 2)
```
Mô¾eme rozdeµova» aj podµa dvoch premenných, v tomto prípade pou¾ijeme funkciu __facet_grid__:

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, colour = class)) +
  facet_grid(drv ~ cyl)
```
Ak nechcete deli» podµa ståpcovej alebo riadkovej premennej, pou¾ite namiesto nej bodku: __. ~ cyl__


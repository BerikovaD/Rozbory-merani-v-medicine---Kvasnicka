---
title: "RTutorial: Within subjects plot"
output: html_notebook
---

## Úvod

V tomto notebooku, ako u¾ viackrát na na¹ich predná¹kach, sa sna¾ím ukáza», ¾e __¹tatistika nie je v¹etko__. ®iadne rafinované testy nenahradia dobrý graf, z ktorého je záver jasný aj bez toho, aby ste kontrolovali èo je ¹tatisticky významené a èo nie, a zaoberali sa kopou zbytoèností typu èi va¹e dáta majú alebo nemajú normálne rozdelenie a èi to je dôle¾ité.

Zároveò si precvièíme veci z minulej predná¹ky, `dplyr`, `tidyr` a `ggplot2`.

Tento notebook som vyrobil podµa blogu https://mvuorre.github.io/post/2017/within-subject-scatter/, aj keï niektoré veci robíme elegantnej¹ie a niekde robíme veci navy¹e.

## Zadanie

Ganis and Kievit (2015) po¾iadali 54 dobrovoµníkov, aby (v niekoµkých experimentoch) porovnali dva vzájomne pootoèené trojrozmerné objekty, a usúdili, èi sa jedná o rovnaký objekt alebo nie.

![Jeden objekt alebo dva?](../pics/Fig01_web.jpg)

Autori v ¹túdii pou¾ili 4 rôzne uhly natoèenia objektov (0, 50, 100 a 150 stupòov), my si ale vezmeme iba dáta s natoèením 50 stupòov, ktoré naèítame priamo z .csv súboru. 

Zaèneme ¹tandardnou úvodnou mantrou.

```{r}
library(tidyverse)
```

a naèítame dáta:

```{r}
d <- read_csv("https://mvuorre.github.io/data/ganis-kievit-2015.csv")
d
```
Ak vám naèítanie z Internetu nefunguje, súbor nájdete aj v repozitári tohto kurzu, `RTutorial/data/ganis-kievit-2015.csv`.

Ståpce, ktoré nás zaujímajú, sú `Subject` (identifikácia úèastníka), `angle` (uhol pootoèenia), `correct.incorrect` (správna / nesprávna odpoveï), `rt` (reakèný èas). Chceme iba pootoèenia 0 a 50 stupòov, a mô¾eme si vhodne premenova» ståpce, aby sa s nimi dobre pracovalo.

Pou¾ijeme variantu príkazu `dplyr::mutate`, ktorá nepridáva ståpce k existujúcim, ale zriadi novú tabu2ku a ståpce pridá do nej: `dplyr::transmute`. Okrem toho si uká¾eme, naèo slú¾i obrátené priradenie `->`.

```{r}
transmute(
    d,
    id = Subject,
    angle = angle,
    correct = correct.incorrect,
    rt = Time
    ) %>%
    filter(angle < 51) -> d

d
```

No a aké to máme dáta?
```{r}
summary(d)
```

## Priemery pre úèastníkov

Pre prvý graf nám staèia priemerné èasy úèastníkov podµa natoèenia. Hypotéza je, ¾e priemerný èas bude dlh¹í pri pootoèených objektoch u v¹etkých úèastníkov.

Potrebujeme zoskupi» dáta podµa úèastníka a uhlu, a pre ka¾dú skupinu vypoèíta» priemerný reakèný èas. Prípadné chýbajúce dáta v skupinách ignorujeme. 

```{r}
group_by(d, id, angle) %>%
    summarize(rt = mean(rt, na.rm = T)) -> subject_means
subject_means
```

Poïme si to nakresli». Chceme (pre zmenu) ståpcový graf, a cezeò nakreslíme priemery pre jednotlivých úèastníkov v danej skupine. 

A aby sme ukázali, ¾e doká¾eme kresli» aj ståpce s errorbarmi, tak pridáme aj tie. __Ak niekoho nachytám, ¾e to fakt pou¾íva, podpálim mu laptop.__

```{r}
ggplot(subject_means, aes(x = angle, y = rt)) +
  geom_bar(
    stat = "summary",
    fun.y = "mean",
    col = "black",
    fill = "gray70"
  ) +
  geom_errorbar(
    stat = "summary", 
    fun.data = "mean_se", 
    col = "black", 
    width = 15
  ) +
  geom_point(position = position_jitter(h = 0, w = 5)) +
  scale_y_continuous(limits = c(0, max(d$rt, na.rm = T)), expand = c(0, 0))
```

Museli sme prida» nový parameter, `stat`, aby sme zmenili ¹tandardný spôsob vytvárania ståpcových grafov, ktorý je `count`, èi¾e poèet prípadov. Ka¾dá geometria (`geom_XXX`) má ¹tandardne priradenú metódu `stat`, a platí to aj naopak, tak¾e predchádzajúci graf mô¾eme úplne dobre nakresli» aj takto:

```{r}
ggplot(subject_means, aes(x = angle, y = rt)) +
  stat_summary(
    geom = "bar",
    fun.y = "mean",
    col = "black",
    fill = "gray70"
  ) +
  stat_summary(
    geom = "errorbar",
    fun.data = "mean_se",
    col = "black",
    width = 15
  ) +
  geom_point(position = position_jitter(h = 0, w = 5)) +
  scale_y_continuous(limits = c(0, max(d$rt, na.rm = T)), expand = c(0, 0))
```
E¹te raz mô¾eme nakresli» to isté, tak ako sme sa u¾ uèili. 

```{r}
ggplot(subject_means, aes(x = angle, y = rt, group = as.factor(angle), colour = as.factor(angle))) +
    geom_boxplot(outlier.shape = NA) + # lebo nakreslíme v¹etky dáta neskôr
    geom_point(position = position_jitter(h = 0, w = 5)) +
    scale_y_continuous(limits = c(0, max(d$rt, na.rm = T)),
    expand = c(0, 0))
```

Nakreslili sme si dáta veµakrát, ale tie obrázky sú vcelku naniè. Oblaky sú veµké vïaka variabilite reakèného èasu medzi úèastníkmi, a my chceme vidie» variáciu u jednotlivých úèastníkov. Mohli by sme pospája» jednotlivé body a pozera», èi spojnice smerujú preva¾ne hore alebo dole, ale to nie je veµmi u¾itoèné, ak máme veµa èiar. 

```{r}
ggplot(subject_means, aes(x = angle, y = rt, group = id, colour = id)) +
  geom_point() + 
  geom_line()
```

## Zobrazenie zmien u jednotlivcov

Poïme vymyslie» nieèo lep¹ie. Pre ka¾dého úèastníka máme reakèné èasy $t_0$ a $t_{50}$. Poïme ich vykresli» proti sebe. 
Na to si potrebujeme upravi» dáta z úzkeho do ¹irokého formátu: potrebujeme, aby reakèný èas pre 0 stupòov a 50 stupòov boli v osobitných ståpcoch. Pou¾ijeme funkciu `dplyr::spread`, a dáme ståpcom zmysluplné mená.

```{r}
subject_means_wide <- spread(subject_means, key = angle, value = rt, sep = "_") %>%
  rename(mean_rt_0deg = angle_0, mean_rt_50deg = angle_50)
subject_means_wide 
```

A teraz poïme kresli».

```{r}
ggplot(subject_means_wide, aes(x = mean_rt_0deg, y = mean_rt_50deg)) +
    geom_point()
```

To je u¾ skoro ono, dáta sú správne, ale celý graf zatiaµ nehovorí, èo sa má poveda»:

1. Aspekt musí by» 1:1
2. Osi musia ma» rovnakú ¹kálu (prvý príkaz ¹kálu vypoèíta pomocou min a max, aby sme ju mohli pou¾i» pre obe osi)
3. Treba nakresli» èiaru y = x (geom_abline)
4. Treba upravi» popisy osí.

```{r}
lims <- c(min(d$rt, na.rm = T), max(d$rt, na.rm = T))
wsplot <-
    ggplot(subject_means_wide, aes(x = mean_rt_0deg, y = mean_rt_50deg)) +
    geom_point() +
    geom_abline() +
    scale_x_continuous("0 degrees", limits = lims) +
    scale_y_continuous("50 degrees", limits = lims) +
    theme(aspect.ratio = 1)
wsplot
```
Tento graf u¾ ukazuje to, èo chceme vidie».
Vidíme, ¾e efekt predå¾enia èasu je *robustný*, v¹etky body le¾ia nad priamkou, tak¾e ani náhodou nepotrebujeme ¾iadny ¹tatistický test, aby sme presvedèivo ukázali efekt vzájomného pootoèenia útvarov na reakèný èas. 
V¹imnite si, ¾e nepotrebujeme ¾iadne dodatoèné èiary, spájajúce body, ani farby èi veµkosti bodov. Nepotrebujeme ani fitova» lineárny èi iný model - graf ukazuje v¹etko, èo potrebujeme vidie». 

## Závereèné vylep¹enia

Poïme ho vylep¹i»: Keï¾e máme niekoµko meraní pre ka¾dého úèastníka, vieme získa» variabilitu jeho reakèných èasov. Tak¾e k súhrnu pridáme ¹tandardné chyby:

```{r}
subject_summaries <- group_by(d, id, angle) %>%
    summarize(mean = mean(rt, na.rm = T),
              se = sd(rt, na.rm = T) / sqrt(n()))
subject_summaries
```
Teraz potrebujeme urobi» rovnaký krok ako predtým, da» dáta do ¹irokého formátu, ale potrebujeme to urobi» pre dva ståpce súèasne. To `dplyr::spread` nevie. Musíme preto pou¾i» iný postup:
1. Spojíme ståpce `mean` a `se` do jedného pomocou `dplyr::gather`, vytvoríme kµúè `val_type` a hodnoty oznaèíme `val`.
2. Z `angle` a `val_type` vyrobíme spoloèný k2úè `rt`.
3. A¾ teraz pou¾ijeme `dplyr::spread` a pomocou kµúèa `rt` rozdelíme ståpec `val` na ¹tyri ståpce `rt_mean_0`, `rt_mean_50`, `rt_se_0`, rt_se_50`.

```{r}
means_and_errors <- gather(subject_summaries, key = "val_type", value = "val", mean, se) %>%
  unite(rt, val_type, angle, sep = "_") %>%
  spread(key = rt, value = val, sep = "_")
means_and_errors
```
__Úloha__: Prejdite si postup po jednotlivých krokoch a uistite sa, ¾e rozumiete, èo sa deje. Odma¾te najprv posledné dve èasti príkazu (unite a spread) a potom iba poslednú èas» (spread).

No a teraz nám u¾ ostáva iba celú tú slávu nakresli»:

```{r}
ggplot(means_and_errors, aes(x=rt_mean_0, y=rt_mean_50)) +
    geom_point() +
    geom_errorbar(aes(ymin=rt_mean_50-rt_se_50, ymax=rt_mean_50+rt_se_50)) +
    geom_errorbarh(aes(xmin=rt_mean_0-rt_se_0, xmax=rt_mean_0+rt_se_0)) +
    geom_abline() +
    scale_x_continuous("0 degrees", limits = lims) +
    scale_y_continuous("50 degrees", limits = lims) +
    theme(aspect.ratio=1)
```

__Úloha__. Nepotrebovali sme niè modelova», ale ako by ste z tejto situácie dostali kompaktný záver o predå¾ení reakènej doby? (Skúste prelo¾i» bodmi priamku.)


## Literatúra:

Ganis, G., & Kievit, R. (2015). A New Set of Three-Dimensional Shapes for Investigating Mental Rotation Processes: Validation Data and Stimulus Set. Journal of Open Psychology Data, 3(1). https://doi.org/10.5334/jopd.ai
